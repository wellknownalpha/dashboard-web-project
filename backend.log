
> secureops-backend@1.0.0 start
> node server-improved.js

ğŸš€ Starting SecureOps Backend Server...
ğŸ“‹ Configuration Check:
   Tenant ID: âœ… Set
   Client ID: âœ… Set
   Client Secret: âœ… Set
ğŸŒ Backend server running at http://localhost:3001
ğŸ“‹ Health check: http://localhost:3001/api/health

âš ï¸  If you see authentication errors:
   1. Check your Azure app registration client secret
   2. Ensure API permissions are granted
   3. Run: node test-api.js to verify credentials
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Graph API token acquired successfully
âœ… Defender API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
âœ… Defender API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Defender API token acquired successfully
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âœ… Successfully fetched 396 total users, 82 with target licenses
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ›¡ï¸ Fetching ALL devices from Microsoft Defender...
âœ… Defender API token acquired successfully
âŒ Failed to fetch devices: {
  error: {
    code: '',
    message: "The query specified in the URI is not valid. Could not find a property named 'loggedOnUsers' on type 'microsoft.windowsDefenderATP.api.Machine'.",
    details: []
  }
}
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Successfully fetched 396 total users, 82 with target licenses
ğŸ“Š Fetching ALL users with licenses from Microsoft Graph...
âœ… Graph API token acquired successfully
ğŸ“„ Fetched 396 users (Total: 396)
âœ… Successfully fetched 396 total users, 82 with target licenses
